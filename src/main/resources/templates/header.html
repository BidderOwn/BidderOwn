<div>
  <div th:replace="import::head"></div>
  <div class="flex justify-center w-full h-[70px] bg-white" id="header_app">
    <div class="flex w-[1200px] h-[70px] justify-between items-center pr-5 pl-5 bg-white">
      <a href="/home">
        <img src="/image/bidder_own_logo.png" width="50" height="50">
      </a>

      <div class="flex min-w-[550px] max-w-[550px] border-solid border-[1px] border-zinc-300 py-2 rounded-lg">
        <div class="pl-3 pr-5 text-indigo-500">검색</div>
        <input type="text" placeholder="찾으시는 상품, 판매자, 내용을 입력하세요" class="w-[450px]" id="search-input"/>
        <button id="search-button" onclick="search()">
          <img src="/image/submit.png" class="w-[25px] h-[25px]">
        </button>
      </div>

      <div class="flex">
        <a href="/chat/list" class="mr-2">
          <img src="/image/chat.png" class="w-[25px] h-[25px]"/>
        </a>
        <a href="#" class="mr-2">
          <img src="/image/notification.png" class="w-[25px] h-[25px]"/>
        </a>
        <a href="javascript:"  onclick="$(this).next().submit();">
          <img src="/image/person2.png" class="w-[25px] h-[25px]"/>
        </a>
        <form hidden th:action="|/member/logout|" method="POST"></form>
      </div>
    </div>
  </div>

  <script>
    let socket;
    let ws;

    $(document).ready(function (){
      $('#search-input').on('keypress', function (event){
        if (event.keyCode === 13 || event.which === 13) {
          $('#search-button').click();
        }
      })
    });

    search = () => {
      const searchText = document.getElementById('search-input').value;
      if (searchText === '') return;
      window.location.href = 'http://localhost:8080/home?q=' + searchText;
    }

    socketConnect = () => {
      const username = localStorage.getItem('username');

      if (username === null) return;

      axios.get('/api/v1/connection/me', {
        auth: {
          username: username,
          password: ''
        }
      })
      .then(response => {
        const connections = response.data;
        connections.forEach(connection => {
          socket = new SockJS("/ws-stomp");
          ws = Stomp.over(socket);
          // let reconnect = 0;

          if (connection.connectionType === 'ITEM') {
            ws.connect({}, (frame) => {
              ws.subscribe("/sub/notification/item/" + connection.connectionId,
                      (message) => {
                        const senderName = message.body;
                        // if (this.username !== senderName) {
                        console.log("icon 표시");
                        // }
                      });
            }, (error) => {
              console.log(error);
            });
          } else if (connection.connectionType === 'CHAT') {
            ws.connect({}, (frame) => {
              ws.subscribe("/sub/chat/room/" + this.roomId,
                (message) => {
                  // let recv = JSON.parse(message.body);
                  // this.recvMessage(recv);
                  console.log("icon 표시");
                });
            }, (error) => {
              console.log(error);
            });
          }
        });
      })
      .catch(error => {
        console.log(error);
      });
    }

    socketConnect();

  </script>
</div>
